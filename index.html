<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Acuapon√≠a Tycoon</title>
    <style>
        /* --- ESTILOS BASE M√ìVIL --- */
        :root {
            --primary: #00796b;
            --accent: #ffb300;
            --bg: #e0f2f1;
            --danger: #e53935;
            --text: #263238;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- CABECERA (HUD) --- */
        header {
            background: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
        }
        .money-badge {
            background: var(--accent);
            color: #3e2723;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 1.1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .level-badge {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* --- √ÅREA VISUAL (SISTEMA) --- */
        .system-view {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 10px;
            overflow: hidden;
        }

        /* Cama de Cultivo (Arriba) */
        .grow-bed {
            flex: 1;
            background: #8d6e63;
            border-radius: 10px;
            border: 4px solid #5d4037;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding-bottom: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .plant {
            font-size: 0;
            transition: font-size 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 2;
        }
        .gravel {
            position: absolute; bottom: 0; left: 0; right: 0; height: 30%;
            background: repeating-linear-gradient(45deg, #795548, #795548 5px, #6d4c41 5px, #6d4c41 10px);
            opacity: 0.5; border-radius: 0 0 6px 6px;
        }

        /* Tanque de Peces (Abajo) */
        .fish-tank {
            flex: 1.5;
            background: linear-gradient(to bottom, #4fc3f7, #0288d1);
            border-radius: 15px;
            border: 4px solid #01579b;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .fish {
            position: absolute;
            font-size: 2rem;
            transition: top 2s, left 2s, transform 0.5s;
            filter: drop-shadow(2px 2px 0 rgba(0,0,0,0.2));
        }
        .water-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: transparent;
            transition: background 1s;
            pointer-events: none;
        }
        .water-dirty { background: rgba(62, 39, 35, 0.7); }

        /* Indicadores Flotantes */
        .stat-bubble {
            position: absolute;
            background: rgba(255,255,255,0.9);
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #ph-meter { bottom: 10px; right: 10px; }
        #amm-meter { bottom: 10px; left: 10px; }

        /* --- BARRA DE ACCIONES (CONTROLES) --- */
        .controls {
            background: white;
            padding: 15px;
            border-top: 1px solid #ddd;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            z-index: 20;
        }

        .btn-action {
            background: white;
            border: 2px solid #ccc;
            border-radius: 12px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.1s;
            position: relative;
            overflow: hidden;
        }
        .btn-action:active { transform: scale(0.95); background: #f5f5f5; }
        .btn-action.primary { border-color: var(--primary); color: var(--primary); background: #e0f2f1; }
        .btn-action.harvest { border-color: var(--accent); background: #fff8e1; color: #ff6f00; }
        .btn-action.danger { border-color: var(--danger); color: var(--danger); animation: pulse 1s infinite; }
        
        .btn-icon { font-size: 1.8rem; }
        .btn-label { font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }

        /* Barra de progreso en bot√≥n */
        .progress-bar {
            position: absolute; bottom: 0; left: 0; height: 4px; width: 0%;
            background: currentColor; transition: width 0.5s;
        }

        /* --- MEN√ö DE TIENDA (MODAL) --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100; justify-content: center; align-items: flex-end;
        }
        .modal-sheet {
            background: white; width: 100%; max-height: 80vh;
            border-radius: 20px 20px 0 0; padding: 20px; box-sizing: border-box;
            overflow-y: auto; animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .shop-grid { display: grid; gap: 15px; }
        .shop-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; background: #f9f9f9; border-radius: 12px; border: 1px solid #eee;
        }
        .shop-info h3 { margin: 0; font-size: 1rem; }
        .shop-info p { margin: 5px 0 0; font-size: 0.8rem; color: #666; }
        .btn-buy {
            background: var(--primary); color: white; border: none;
            padding: 8px 16px; border-radius: 20px; font-weight: bold;
        }
        .btn-buy:disabled { background: #ccc; }

        /* --- TEXTOS FLOTANTES --- */
        .floater {
            position: absolute; font-weight: bold; pointer-events: none;
            animation: floatUp 1s ease-out forwards; z-index: 50;
            text-shadow: 0 0 3px white;
        }
        @keyframes floatUp { to { transform: translateY(-50px); opacity: 0; } }
        @keyframes pulse { 50% { opacity: 0.6; } }

        /* ESTADOS */
        .dead-fish { transform: rotate(180deg) !important; filter: grayscale(100%); }

    </style>
</head>
<body>

<header>
    <div class="level-badge">Nivel <span id="lvl">1</span></div>
    <div class="money-badge">üí∞ <span id="money">0</span></div>
</header>

<div class="system-view" id="game-area">
    <!-- CAMA DE CULTIVO -->
    <div class="grow-bed" onclick="harvest()">
        <div class="gravel"></div>
        <div class="plant" id="p1">ü•¨</div>
        <div class="plant" id="p2">ü•¨</div>
        <div class="plant" id="p3">ü•¨</div>
        <div class="stat-bubble" style="top: 10px; right: 10px;">
            ‚ö° Crecimiento: <span id="grow-rate">x1</span>
        </div>
    </div>

    <!-- TANQUE DE PECES -->
    <div class="fish-tank">
        <div class="water-overlay" id="water"></div>
        <div id="fish-container"></div>
        
        <div class="stat-bubble" id="amm-meter">üß™ NH3: <span id="val-nh3">0</span></div>
        <div class="stat-bubble" id="ph-meter">üíß pH: <span id="val-ph">7.0</span></div>
    </div>
</div>

<!-- CONTROLES INFERIORES -->
<div class="controls">
    <div class="btn-action primary" onclick="feedFish()">
        <span class="btn-icon">ü¶ê</span>
        <span class="btn-label">Alimentar</span>
    </div>
    
    <div class="btn-action" id="btn-clean" onclick="cleanTank()">
        <div class="progress-bar" id="clean-bar"></div>
        <span class="btn-icon">üßπ</span>
        <span class="btn-label">Limpiar</span>
    </div>

    <div class="btn-action" id="btn-ph" onclick="fixPH()">
        <span class="btn-icon">üíä</span>
        <span class="btn-label">Ajustar pH</span>
    </div>

    <div class="btn-action harvest" onclick="harvest()" style="grid-column: span 3; background: #fff8e1;">
        <span class="btn-icon">ü•¨</span>
        <span class="btn-label">COSECHAR Y VENDER</span>
        <div style="font-size:0.7rem; color:#ff6f00;">(Click aqu√≠ cuando crezcan)</div>
    </div>

    <div class="btn-action" onclick="openShop()" style="grid-column: span 3; background: #e8eaf6; border-color: #3f51b5; color: #3f51b5;">
        <span class="btn-icon">üõí</span>
        <span class="btn-label">TIENDA DE MEJORAS</span>
    </div>
</div>

<!-- TIENDA (MODAL) -->
<div id="shop-modal" class="modal-overlay" onclick="if(event.target === this) closeShop()">
    <div class="modal-sheet">
        <h2 style="margin-top:0; color:var(--primary);">Tienda Acuap√≥nica</h2>
        <div class="shop-grid">
            <div class="shop-item">
                <div class="shop-icon">üêü</div>
                <div class="shop-info">
                    <h3>M√°s Peces</h3>
                    <p>Producen m√°s nutrientes (Amon√≠aco) para las plantas.</p>
                </div>
                <button class="btn-buy" onclick="buyUpgrade('fish')" id="buy-fish">$50</button>
            </div>
            <div class="shop-item">
                <div class="shop-icon">ü¶†</div>
                <div class="shop-info">
                    <h3>Biofiltro Mejorado</h3>
                    <p>Convierte el Amon√≠aco peligroso en comida m√°s r√°pido.</p>
                </div>
                <button class="btn-buy" onclick="buyUpgrade('bio')" id="buy-bio">$100</button>
            </div>
            <div class="shop-item">
                <div class="shop-icon">üí°</div>
                <div class="shop-info">
                    <h3>Luces LED</h3>
                    <p>Las plantas crecen un 50% m√°s r√°pido.</p>
                </div>
                <button class="btn-buy" onclick="buyUpgrade('light')" id="buy-light">$200</button>
            </div>
        </div>
        <button onclick="closeShop()" style="width:100%; padding:15px; margin-top:20px; border:none; background:#eee; border-radius:10px; font-weight:bold;">Cerrar</button>
    </div>
</div>

<script>
    /* --- L√ìGICA DEL JUEGO --- */
    const GAME = {
        money: 0,
        level: 1,
        
        // Biolog√≠a
        fishCount: 3,
        fishHealth: 100,
        bacteriaLevel: 1, // Velocidad de conversi√≥n
        plantGrowth: 0,   // 0 a 100%
        growthRate: 0.5,  // Por tick
        
        // Qu√≠mica
        ammonia: 0, // NH3 (T√≥xico si > 10)
        nitrates: 0, // Comida plantas
        ph: 7.0,     // Ideal 6.8-7.2
        
        loop: null
    };

    const PRICES = { fish: 50, bio: 100, light: 200 };

    // Iniciar
    init();

    function init() {
        updateMoney(0);
        renderFish();
        GAME.loop = setInterval(tick, 500); // Game loop r√°pido (0.5s)
    }

    function tick() {
        // 1. Peces producen desechos (Amon√≠aco)
        if (GAME.fishHealth > 0) {
            GAME.ammonia += (GAME.fishCount * 0.1);
        }

        // 2. Bacterias convierten (Biofiltro)
        // Convierte amon√≠aco en nitratos (comida)
        let conversion = GAME.bacteriaLevel * 0.5;
        
        // El pH afecta a las bacterias
        if (GAME.ph < 6.0 || GAME.ph > 8.0) conversion = 0;

        if (GAME.ammonia > 0) {
            let amount = Math.min(GAME.ammonia, conversion);
            GAME.ammonia -= amount;
            GAME.nitrates += amount;
            
            // La conversi√≥n acidifica el agua (baja pH)
            if (amount > 0) GAME.ph -= 0.01;
        }

        // 3. Plantas crecen
        if (GAME.nitrates > 0 && GAME.ph > 6.0 && GAME.ph < 7.5) {
            GAME.plantGrowth += GAME.growthRate;
            GAME.nitrates -= 0.1; // Consumen comida
        }
        
        // 4. Consecuencias (Da√±o)
        if (GAME.ammonia > 10) {
            GAME.fishHealth -= 2;
            showFloater("‚ö†Ô∏è ¬°T√≥xico!", 50, 50, "red");
        }
        if (GAME.ph < 6.0 || GAME.ph > 8.0) {
            GAME.fishHealth -= 1;
        }

        // Clamp y UI
        if (GAME.plantGrowth > 100) GAME.plantGrowth = 100;
        if (GAME.ammonia < 0) GAME.ammonia = 0;
        if (GAME.nitrates < 0) GAME.nitrates = 0;
        if (GAME.fishHealth <= 0 && GAME.fishCount > 0) killFish();

        updateUI();
    }

    /* --- ACCIONES DEL JUGADOR --- */

    function feedFish() {
        if (GAME.fishHealth <= 0) return;
        
        GAME.ammonia += 2; // La comida genera amon√≠aco
        GAME.nitrates += 1;
        
        // Animaci√≥n visual
        showFloater("ü¶ê √ëam", Math.random()*80 + 10, 70, "orange");
        
        // Efecto peces
        document.querySelectorAll('.fish').forEach(f => {
            f.style.transform = "scale(1.2)";
            setTimeout(() => f.style.transform = "scale(1)", 200);
        });
    }

    function cleanTank() {
        if (GAME.ammonia > 0) {
            GAME.ammonia -= 5;
            if (GAME.ammonia < 0) GAME.ammonia = 0;
            showFloater("‚ú® Limpio", 50, 60, "#4fc3f7");
        } else {
            showFloater("Ya est√° limpio", 50, 60, "#aaa");
        }
    }

    function fixPH() {
        GAME.ph += 0.5;
        if (GAME.ph > 8.0) GAME.ph = 8.0; // Tope
        showFloater("üíä pH Subiendo", 80, 60, "#e040fb");
    }

    function harvest() {
        if (GAME.plantGrowth >= 100) {
            // Cosecha exitosa
            let earnings = 20 * GAME.level;
            updateMoney(earnings);
            showFloater(`üí∞ +$${earnings}`, 50, 30, "gold");
            
            GAME.plantGrowth = 0; // Reiniciar plantas
            
            // Subir de nivel cada 5 cosechas (simplificado)
            if (Math.random() > 0.7) {
                GAME.level++;
                showFloater("üèÜ ¬°NIVEL ARRIBA!", 50, 50, "gold");
                document.getElementById('lvl').innerText = GAME.level;
            }
        } else {
            showFloater("üå± A√∫n no est√° lista", 50, 30, "#81c784");
        }
    }

    /* --- SISTEMA DE TIENDA --- */
    function openShop() {
        document.getElementById('shop-modal').style.display = 'flex';
        checkPrices();
    }
    function closeShop() {
        document.getElementById('shop-modal').style.display = 'none';
    }

    function checkPrices() {
        document.getElementById('buy-fish').disabled = GAME.money < PRICES.fish;
        document.getElementById('buy-bio').disabled = GAME.money < PRICES.bio;
        document.getElementById('buy-light').disabled = GAME.money < PRICES.light;
    }

    function buyUpgrade(type) {
        if (GAME.money >= PRICES[type]) {
            updateMoney(-PRICES[type]);
            
            if (type === 'fish') {
                GAME.fishCount++;
                renderFish();
                PRICES.fish = Math.floor(PRICES.fish * 1.5);
                document.getElementById('buy-fish').innerText = `$${PRICES.fish}`;
            }
            else if (type === 'bio') {
                GAME.bacteriaLevel++;
                PRICES.bio = Math.floor(PRICES.bio * 1.5);
                document.getElementById('buy-bio').innerText = `$${PRICES.bio}`;
            }
            else if (type === 'light') {
                GAME.growthRate += 0.2;
                PRICES.light = Math.floor(PRICES.light * 1.5);
                document.getElementById('buy-light').innerText = `$${PRICES.light}`;
                document.getElementById('grow-rate').innerText = `x${(GAME.growthRate*2).toFixed(1)}`;
            }
            checkPrices();
            closeShop();
            showFloater("‚úÖ ¬°Mejora Comprada!", 50, 50, "#00c853");
        }
    }

    /* --- VISUALES Y UI --- */
    
    function updateMoney(amount) {
        GAME.money += amount;
        document.getElementById('money').innerText = GAME.money;
    }

    function updateUI() {
        // Plantas (Tama√±o)
        let size = 10 + (GAME.plantGrowth * 0.4); // 10px a 50px
        document.querySelectorAll('.plant').forEach(p => {
            p.style.fontSize = `${size}px`;
            p.innerText = GAME.plantGrowth >= 100 ? "ü•¨" : "üå±";
        });

        // Agua (Color)
        const water = document.getElementById('water');
        if (GAME.ammonia > 8) water.classList.add('water-dirty');
        else water.classList.remove('water-dirty');

        // Botones Alerta
        const btnClean = document.getElementById('btn-clean');
        if (GAME.ammonia > 5) btnClean.classList.add('danger');
        else btnClean.classList.remove('danger');

        const btnPh = document.getElementById('btn-ph');
        if (GAME.ph < 6.0) btnPh.classList.add('danger');
        else btnPh.classList.remove('danger');

        // Valores Num√©ricos
        document.getElementById('val-nh3').innerText = GAME.ammonia.toFixed(1);
        document.getElementById('val-nh3').style.color = GAME.ammonia > 5 ? 'red' : '#333';
        
        document.getElementById('val-ph').innerText = GAME.ph.toFixed(1);
        document.getElementById('val-ph').style.color = (GAME.ph < 6.0 || GAME.ph > 8.0) ? 'red' : '#333';
    }

    function renderFish() {
        const container = document.getElementById('fish-container');
        container.innerHTML = '';
        for(let i=0; i<GAME.fishCount; i++) {
            let f = document.createElement('div');
            f.className = 'fish';
            f.innerText = 'üêü';
            // Posici√≥n aleatoria
            f.style.left = Math.random() * 80 + '%';
            f.style.top = Math.random() * 80 + '%';
            container.appendChild(f);
        }
        // Movimiento
        moveFish();
    }

    function moveFish() {
        document.querySelectorAll('.fish').forEach(f => {
            if (GAME.fishHealth <= 0) return; // No mover si muertos
            f.style.left = Math.random() * 80 + '%';
            f.style.top = Math.random() * 80 + '%';
            f.style.transform = Math.random() > 0.5 ? "scaleX(1)" : "scaleX(-1)";
        });
        setTimeout(moveFish, 2000);
    }

    function killFish() {
        document.querySelectorAll('.fish').forEach(f => {
            f.classList.add('dead-fish');
            f.innerText = '‚ò†Ô∏è';
        });
        showFloater("Tus peces han muerto", 50, 50, "red");
        // Reset parcial para no frustrar
        setTimeout(() => {
            alert("GAME OVER: Tus peces murieron por mala calidad del agua. Se han comprado nuevos alevines autom√°ticamente.");
            GAME.fishHealth = 100;
            GAME.ammonia = 0;
            GAME.ph = 7.0;
            renderFish();
        }, 1000);
    }

    function showFloater(text, xPercent, yPercent, color) {
        let f = document.createElement('div');
        f.className = 'floater';
        f.innerText = text;
        f.style.left = xPercent + '%';
        f.style.top = yPercent + '%';
        f.style.color = color;
        document.body.appendChild(f);
        setTimeout(() => f.remove(), 1000);
    }

</script>
</body>
</html>
