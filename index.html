<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eco-Huerto: Laboratorio Digital</title>
    <!-- Fuentes e Iconos -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Paleta de Colores "Eco-Friendly" */
            --primary-green: #4CAF50;
            --dark-green: #2E7D32;
            --water-blue: #039BE5;
            --sun-yellow: #FFB300;
            --alert-red: #E53935;
            --energy-orange: #FF5722; /* Para Educaci√≥n F√≠sica */
            --bg-color: #F1F8E9;
            --card-bg: #FFFFFF;
            --text-color: #37474F;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-image: url('https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?q=80&w=2727&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }

        body::before {
            content: "";
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9); /* Un poco m√°s opaco para legibilidad */
            z-index: -1;
        }

        /* --- UI GENERAL --- */
        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            z-index: 10;
            padding-bottom: 80px; /* Espacio para scroll */
        }
        .screen.active { display: flex; animation: fadeIn 0.4s ease-out; }

        h1, h2, h3 { color: var(--dark-green); margin: 0.5em 0; font-weight: 900; }
        
        .header-bar {
            display: flex; justify-content: space-between; align-items: center;
            background: white;
            padding: 15px 20px;
            margin: -20px -20px 20px -20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
            position: sticky; top: 0; z-index: 20;
        }

        .header-title { font-size: 1.2rem; color: var(--dark-green); font-weight: 800; display: flex; align-items: center; gap: 8px; }

        /* Botones */
        .btn {
            background: var(--primary-green); color: white; border: none; padding: 15px; margin: 10px 0;
            font-weight: 700; border-radius: 12px; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            font-size: 1rem; font-family: 'Nunito', sans-serif;
            box-shadow: 0 4px 0 #388E3C; width: 100%;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn.outline { background: white; color: var(--text-color); border: 2px solid #ddd; box-shadow: none; }
        .btn.orange { background: var(--energy-orange); box-shadow: 0 4px 0 #D84315; }

        /* Paneles */
        .panel {
            background: var(--card-bg); padding: 20px; border-radius: 20px;
            margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.05);
        }

        /* Notas */
        .notebook-note {
            background: #FFF9C4; border-left: 5px solid var(--sun-yellow);
            padding: 15px; margin: 15px 0; font-size: 0.95em; color: #5D4037; border-radius: 8px;
        }
        .notebook-note strong { display: block; margin-bottom: 5px; color: #F57F17; }

        /* --- SECCIONES DEL GRID --- */
        .section-title {
            font-size: 1rem; color: #78909C; margin: 20px 0 10px 0; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; border-bottom: 2px solid #CFD8DC; padding-bottom: 5px;
        }

        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .module-card {
            background: white; padding: 15px 10px; text-align: center;
            border-radius: 20px; box-shadow: var(--shadow); cursor: pointer; transition: 0.3s;
            border: 2px solid transparent; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .module-card:hover { transform: translateY(-5px); border-color: var(--primary-green); }
        .module-card i { font-size: 2.5rem; margin-bottom: 10px; background: -webkit-linear-gradient(#66BB6A, #2E7D32); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .tag { font-size: 0.65em; padding: 3px 8px; border-radius: 10px; font-weight: bold; margin-top: 5px; }
        .tag.info { background: #E1F5FE; color: var(--water-blue); }
        .tag.alert { background: #FFEBEE; color: var(--alert-red); }
        .tag.phys { background: #FBE9E7; color: var(--energy-orange); }

        /* Inputs para Bit√°cora */
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-size: 0.9rem; color: #546E7A; margin-bottom: 5px; font-weight: bold; }
        .input-group input { width: 100%; padding: 12px; border: 2px solid #CFD8DC; border-radius: 10px; font-family: 'Nunito'; font-size: 1rem; }
        .input-group input:focus { border-color: var(--primary-green); outline: none; }

        /* Checklist Actividad F√≠sica */
        .phys-check { display: flex; align-items: center; gap: 10px; background: #FAFAFA; padding: 10px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #EEEEEE; }
        .phys-check input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--energy-orange); }

        /* Animaciones */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Modal */
        #modal-success { background: rgba(255, 255, 255, 0.95); }

    </style>
</head>
<body>

    <!-- PANTALLA 1: INICIO -->
    <div id="screen-boot" class="screen active" style="justify-content: center; align-items: center; text-align: center;">
        <div style="background: white; padding: 40px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 90%; max-width: 400px;">
            <i class="material-icons" style="font-size: 5rem; color: var(--primary-green);">eco</i>
            <h1 style="font-size: 2.2rem; margin: 10px 0;">Eco-Huerto</h1>
            <p style="color: #78909C; margin-bottom: 20px;">Gesti√≥n Integral & Bienestar</p>
            <div style="width: 100%; height: 8px; background: #E0E0E0; border-radius: 4px; overflow: hidden;">
                <div id="boot-bar" style="width: 0%; height: 100%; background: var(--primary-green); transition: width 0.1s;"></div>
            </div>
        </div>
    </div>

    <!-- PANTALLA 2: MEN√ö PRINCIPAL -->
    <div id="screen-dashboard" class="screen">
        <div class="header-bar">
            <div class="header-title"><i class="material-icons">dashboard</i> Panel de Control</div>
            <div style="font-size: 0.8rem; font-weight: bold; color: var(--dark-green);">Semana 9-16</div>
        </div>
        
        <!-- FASE 1: INVESTIGACI√ìN (Compacto) -->
        <div class="section-title">Fase 1: Investigaci√≥n</div>
        <div class="grid-menu" style="grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px;">
            <div class="module-card" onclick="navTo('screen-english')" style="padding: 10px;">
                <i class="material-icons" style="font-size: 1.5rem; margin:0;">public</i>
                <span style="font-size: 0.7rem;">Ingl√©s</span>
            </div>
            <div class="module-card" onclick="navTo('screen-tech')" style="padding: 10px;">
                <i class="material-icons" style="font-size: 1.5rem; margin:0;">build</i>
                <span style="font-size: 0.7rem;">Tecnolog√≠a</span>
            </div>
            <div class="module-card" onclick="navTo('screen-bio')" style="padding: 10px;">
                <i class="material-icons" style="font-size: 1.5rem; margin:0;">history_edu</i>
                <span style="font-size: 0.7rem;">Biolog√≠a</span>
            </div>
            <div class="module-card" onclick="navTo('screen-cam')" style="padding: 10px;">
                <i class="material-icons" style="font-size: 1.5rem; margin:0;">camera_alt</i>
                <span style="font-size: 0.7rem;">Evidencia</span>
            </div>
        </div>

        <!-- FASE 2: CAMPO Y MONITOREO -->
        <div class="section-title">Fase 2: Trabajo de Campo</div>
        <div class="grid-menu">
            <!-- M√≥dulo Siembra -->
            <div class="module-card" onclick="navTo('screen-sowing')">
                <i class="material-icons" style="background: -webkit-linear-gradient(#8D6E63, #5D4037); -webkit-background-clip: text;">local_florist</i>
                <h4>Ciclo de Vida</h4>
                <span class="tag info">Siembra/Trasplante</span>
            </div>

            <!-- M√≥dulo Bit√°cora -->
            <div class="module-card" onclick="navTo('screen-logbook')">
                <i class="material-icons" style="background: -webkit-linear-gradient(#29B6F6, #0288D1); -webkit-background-clip: text;">assignment</i>
                <h4>Bit√°cora</h4>
                <span class="tag alert">Registro Datos</span>
            </div>

            <!-- M√≥dulo Rutina Diaria -->
            <div class="module-card" onclick="navTo('screen-daily')">
                <i class="material-icons" style="background: -webkit-linear-gradient(#FFA726, #F57C00); -webkit-background-clip: text;">set_meal</i>
                <h4>Rutina Diaria</h4>
                <span class="tag info">Peces/Limpieza</span>
            </div>

            <!-- M√≥dulo Bienestar F√≠sico (Ed. F√≠sica) -->
            <div class="module-card" onclick="navTo('screen-phys-ed')">
                <i class="material-icons" style="background: -webkit-linear-gradient(#FF7043, #D84315); -webkit-background-clip: text;">directions_run</i>
                <h4>Bienestar F√≠sico</h4>
                <span class="tag phys">Ed. F√≠sica</span>
            </div>
        </div>
    </div>

    <!-- M√ìDULO: CICLO DE VIDA (Siembra y Trasplante) -->
    <div id="screen-sowing" class="screen">
        <div class="header-bar">
            <div class="header-title"><i class="material-icons" style="color:#5D4037;">local_florist</i> Cultivo</div>
            <button onclick="navTo('screen-dashboard')" class="btn outline" style="width: auto; padding: 5px 15px;">Volver</button>
        </div>

        <div class="notebook-note">
            <strong><i class="material-icons">edit</i> Actividad:</strong>
            Observa tus semilleros. Antes de trasplantar al sistema, verifica estos 3 criterios.
        </div>

        <div class="panel">
            <h3>Lista de Verificaci√≥n de Trasplante</h3>
            <p style="font-size: 0.9rem; color: #78909C;">Marca SOLO si se cumple en la vida real:</p>
            
            <div class="phys-check">
                <input type="checkbox" id="check-leaves">
                <label>Tiene al menos 2 pares de hojas verdaderas.</label>
            </div>
            <div class="phys-check">
                <input type="checkbox" id="check-roots">
                <label>Ra√≠ces blancas visibles saliendo del sustrato.</label>
            </div>
            <div class="phys-check">
                <input type="checkbox" id="check-height">
                <label>Altura mayor a 5 cm.</label>
            </div>

            <button class="btn" onclick="validateSowing()">Validar Trasplante</button>
        </div>
    </div>

    <!-- M√ìDULO: BIT√ÅCORA DIGITAL (Monitoreo de Agua) -->
    <div id="screen-logbook" class="screen">
        <div class="header-bar">
            <div class="header-title"><i class="material-icons" style="color:#0288D1;">assignment</i> Bit√°cora</div>
            <button onclick="navTo('screen-dashboard')" class="btn outline" style="width: auto; padding: 5px 15px;">Volver</button>
        </div>

        <div class="panel">
            <h3>Registro Semanal de Calidad</h3>
            <p>Introduce los datos obtenidos con el kit de pruebas:</p>

            <div class="input-group">
                <label>pH del Agua (Ideal: 6.8 - 7.2)</label>
                <input type="number" id="input-ph" placeholder="Ej: 7.0" step="0.1">
            </div>

            <div class="input-group">
                <label>Temperatura (¬∞C)</label>
                <input type="number" id="input-temp" placeholder="Ej: 24">
            </div>

            <div class="input-group">
                <label>Nitritos (NO2) ppm</label>
                <input type="number" id="input-no2" placeholder="Ej: 0">
            </div>

            <button class="btn" onclick="validateLogbook()">Registrar Datos</button>
            <div id="logbook-feedback" style="margin-top: 15px; font-weight: bold; display: none;"></div>
        </div>
    </div>

    <!-- M√ìDULO: RUTINA DIARIA (Peces) -->
    <div id="screen-daily" class="screen">
        <div class="header-bar">
            <div class="header-title"><i class="material-icons" style="color:#F57C00;">set_meal</i> Rutina</div>
            <button onclick="navTo('screen-dashboard')" class="btn outline" style="width: auto; padding: 5px 15px;">Volver</button>
        </div>

        <div class="panel">
            <h3>Alimentaci√≥n & Observaci√≥n</h3>
            <p>Observa a los peces durante 5 minutos mientras comen.</p>
            
            <div class="choice-card" onclick="selectBehavior(1, this)">
                <div class="choice-circle"></div>
                <div>
                    <strong>Comen vorazmente</strong>
                    <div style="font-size:0.85em;">Nadan r√°pido hacia la comida. (Saludable)</div>
                </div>
            </div>
            <div class="choice-card" onclick="selectBehavior(2, this)">
                <div class="choice-circle"></div>
                <div>
                    <strong>Nadan de lado / Flotan</strong>
                    <div style="font-size:0.85em;">Movimientos err√°ticos. (Alerta Enfermedad)</div>
                </div>
            </div>
            <div class="choice-card" onclick="selectBehavior(3, this)">
                <div class="choice-circle"></div>
                <div>
                    <strong>Rechazan la comida</strong>
                    <div style="font-size:0.85em;">Comida se queda en el fondo. (Estr√©s/Fr√≠o)</div>
                </div>
            </div>

            <button class="btn" onclick="validateDaily()">Guardar Observaci√≥n</button>
        </div>
    </div>

    <!-- M√ìDULO: BIENESTAR F√çSICO (PDA Educaci√≥n F√≠sica) -->
    <div id="screen-phys-ed" class="screen">
        <div class="header-bar">
            <div class="header-title"><i class="material-icons" style="color:#D84315;">directions_run</i> Bienestar</div>
            <button onclick="navTo('screen-dashboard')" class="btn outline" style="width: auto; padding: 5px 15px;">Volver</button>
        </div>

        <div class="notebook-note" style="background: #FBE9E7; border-color: #FF5722;">
            <strong><i class="material-icons" style="color: #FF5722;">favorite</i> Autoevaluaci√≥n F√≠sica:</strong>
            El mantenimiento del huerto es actividad f√≠sica. ¬°Tu cuerpo trabaja mientras cuidas la naturaleza!
        </div>

        <div class="panel">
            <h3>Registro de Esfuerzo F√≠sico</h3>
            <p>Selecciona las tareas realizadas hoy:</p>
            
            <div class="phys-check">
                <input type="checkbox" value="Cargar Cubetas (Fuerza Brazos)">
                <label>Cargar cubetas de agua (Fuerza)</label>
            </div>
            <div class="phys-check">
                <input type="checkbox" value="Limpiar Filtros (Flexibilidad)">
                <label>Limpieza de filtros (Sentadillas/Flexi√≥n)</label>
            </div>
            <div class="phys-check">
                <input type="checkbox" value="Recorrido (Cardio)">
                <label>Recorrido de inspecci√≥n (Caminata)</label>
            </div>

            <p style="margin-top: 20px;">¬øC√≥mo te sientes despu√©s de la jornada?</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn outline" onclick="physFeel('Energizado')">‚ö° Energizado</button>
                <button class="btn outline" onclick="physFeel('Cansado')">üí§ Cansado</button>
                <button class="btn outline" onclick="physFeel('Relajado')">üòå Relajado</button>
            </div>
        </div>
    </div>

    <!-- PANTALLAS DE FASE 1 (Mantenidas ocultas por defecto pero accesibles) -->
    <div id="screen-english" class="screen">
        <div class="header-bar"><div class="header-title">Ingl√©s</div><button onclick="navTo('screen-dashboard')" class="btn outline" style="width:auto; padding:5px;">X</button></div>
        <div class="panel">
            <h3>Sustainable Labs</h3>
            <p>"Aquaponics is a <strong>closed-loop system</strong>. Fish waste feeds plants, plants filter water."</p>
            <p>Question: What filters the water?</p>
            <button class="btn outline" onclick="alert('Correct! Plants filter the water.')">A) Plants</button>
            <button class="btn outline" onclick="alert('Incorrect.')">B) Fish</button>
        </div>
    </div>
    
    <div id="screen-tech" class="screen">
        <div class="header-bar"><div class="header-title">Tecnolog√≠a</div><button onclick="navTo('screen-dashboard')" class="btn outline" style="width:auto; padding:5px;">X</button></div>
        <div class="panel"><h3>Soluci√≥n de Problemas</h3><p>Bomba atascada: Limpiar (Sostenible) vs Comprar (Caro).</p></div>
    </div>
    
    <div id="screen-bio" class="screen">
        <div class="header-bar"><div class="header-title">Biolog√≠a</div><button onclick="navTo('screen-dashboard')" class="btn outline" style="width:auto; padding:5px;">X</button></div>
        <div class="panel"><h3>Saberes Ancestrales</h3><p>Chinampas (Lodo) = Acuapon√≠a (Desechos).</p></div>
    </div>

    <div id="screen-cam" class="screen">
        <div class="header-bar"><div class="header-title">C√°mara</div><button onclick="navTo('screen-dashboard')" class="btn outline" style="width:auto; padding:5px;">X</button></div>
        <div class="panel">
            <video id="camera-feed" autoplay playsinline style="width:100%; height:200px; background:#000; display:none;"></video>
            <button class="btn" onclick="initCamera()">Activar C√°mara</button>
        </div>
    </div>

    <!-- MODAL SUCCESS -->
    <div id="modal-success" style="position:fixed; top:0; left:0; width:100%; height:100%; display:none; flex-direction:column; justify-content:center; align-items:center; z-index:100; backdrop-filter: blur(5px); background: rgba(0,0,0,0.3);">
        <div style="background: white; padding: 30px; border-radius: 30px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.2); width: 85%; max-width: 350px;">
            <div style="background: #E8F5E9; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
                <i class="material-icons" style="font-size: 3rem; color: var(--primary-green);">check</i>
            </div>
            <h2 id="modal-title" style="color:var(--text-color); margin: 10px 0;">¬°Registrado!</h2>
            <p id="success-msg" style="color: #546E7A; margin-bottom: 20px;">Datos guardados en bit√°cora.</p>
            <button class="btn" onclick="closeModal()">Continuar</button>
        </div>
    </div>

    <script>
        // --- BOOT ---
        window.onload = () => {
            let width = 0; const bar = document.getElementById('boot-bar');
            const interval = setInterval(() => {
                width += 5; bar.style.width = width + '%';
                if(width >= 100) { clearInterval(interval); setTimeout(() => navTo('screen-dashboard'), 500); }
            }, 30);
        };

        function navTo(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            // Detener c√°mara si se sale de esa pantalla
            const video = document.getElementById('camera-feed');
            if(video.srcObject) { video.srcObject.getTracks().forEach(t => t.stop()); video.srcObject = null; video.style.display='none'; }
        }

        function showSuccess(title, msg) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('success-msg').innerText = msg;
            document.getElementById('modal-success').style.display = 'flex';
        }
        function closeModal() { document.getElementById('modal-success').style.display = 'none'; navTo('screen-dashboard'); }

        // --- L√ìGICA DE M√ìDULOS NUEVOS ---

        // 1. Siembra
        function validateSowing() {
            const c1 = document.getElementById('check-leaves').checked;
            const c2 = document.getElementById('check-roots').checked;
            const c3 = document.getElementById('check-height').checked;

            if(c1 && c2 && c3) {
                showSuccess("¬°Listo para Trasplante!", "La pl√°ntula es fuerte y sobrevivir√° en el sistema.");
            } else {
                alert("A√∫n no est√° lista. Si la trasplantas ahora, podr√≠a morir. Espera a que cumpla todos los criterios.");
            }
        }

        // 2. Bit√°cora (Validaci√≥n de rangos)
        function validateLogbook() {
            const ph = parseFloat(document.getElementById('input-ph').value);
            const no2 = parseFloat(document.getElementById('input-no2').value);
            const feedback = document.getElementById('logbook-feedback');
            
            if(isNaN(ph)) { alert("Ingresa al menos el pH."); return; }

            feedback.style.display = 'block';
            let msg = "";
            let title = "Registro Completado";

            // L√≥gica de feedback educativo
            if (ph < 6.0) {
                feedback.style.color = "var(--alert-red)";
                feedback.innerText = "ALERTA: Agua muy √°cida. Revisa el biofiltro.";
                msg = "Se ha registrado una anomal√≠a de acidez.";
                title = "Alerta Registrada";
            } else if (ph > 7.6) {
                feedback.style.color = "var(--alert-red)";
                feedback.innerText = "ALERTA: Agua muy alcalina. Las plantas no absorber√°n hierro.";
                msg = "Se ha registrado una anomal√≠a de alcalinidad.";
                title = "Alerta Registrada";
            } else {
                feedback.style.color = "var(--primary-green)";
                feedback.innerText = "Par√°metros Saludables. ¬°Buen trabajo!";
                msg = "Los niveles de pH son √≥ptimos para peces y plantas.";
            }

            if (no2 > 0.5) {
                feedback.innerText += " PELIGRO: Nitritos altos.";
                msg += " ¬°Det√©n la alimentaci√≥n inmediatamente!";
            }

            setTimeout(() => { showSuccess(title, msg); }, 1500);
        }

        // 3. Rutina Diaria
        let fishBehavior = 0;
        function selectBehavior(id, el) {
            fishBehavior = id;
            document.querySelectorAll('.choice-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
        }
        function validateDaily() {
            if(fishBehavior === 0) { alert("Selecciona un comportamiento."); return; }
            if(fishBehavior === 1) showSuccess("Peces Sanos", "Apetito voraz es el mejor indicador de salud.");
            else showSuccess("Alerta Veterinaria", "Comportamiento anormal registrado en bit√°cora. Observar por 24h.");
        }

        // 4. Bienestar F√≠sico
        function physFeel(feeling) {
            showSuccess("¬°Buen Entrenamiento!", `Has registrado tu actividad f√≠sica. Sentirse ${feeling} es parte del proceso de adaptaci√≥n. ¬°Hidr√°tate!`);
        }

        // --- C√ÅMARA ---
        async function initCamera() {
            try {
                const video = document.getElementById('camera-feed');
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                video.srcObject = stream; video.style.display = 'block';
            } catch(e) { alert("Error c√°mara (usa HTTPS): " + e); }
        }

    </script>
</body>
</html>
